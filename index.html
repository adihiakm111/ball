<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Tilt Balance Game</title>

<style>
body{
  margin:0;
  height:100vh;
  background:#0f0f0f;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-family:Arial;
  color:white;
  overflow:hidden;
}

/* HUD */
#hud{
  font-size:22px;
  margin-bottom:15px;
}

/* TRACK */
#main{
  position:relative;
  width:100vw;
  max-width:1200px;
  height:110px;
  background:#2b2b2b;
  border-radius:50px;
  overflow:hidden;
}

/* CENTER WALL */
#main::after{
  content:"";
  position:absolute;
  left:50%;
  top:0;
  width:8px;
  height:100%;
  background:red;
  transform:translateX(-50%);
}

/* BALL */
#ball{
  position:absolute;
  width:90px;
  height:90px;
  border-radius:50%;
  background:#00e5ff;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
}

/* SCREENS */
#start,#rotate,#over{
  position:fixed;
  inset:0;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  gap:20px;
  z-index:10;
}

#rotate,#over{ display:none; }

button{
  font-size:22px;
  padding:12px 30px;
}
</style>
</head>

<body>

<div id="start">
  <button id="startBtn">START GAME</button>
</div>

<div id="rotate">Phone ko LANDSCAPE me ghumao ðŸ”„</div>

<div id="hud">TIME: <span id="time">0</span></div>

<div id="main">
  <div id="ball"></div>
</div>

<div id="over">
  <div style="font-size:36px;">GAME OVER</div>
  <button onclick="restart()">RESTART</button>
</div>

<script>
const main = document.getElementById("main");
const ball = document.getElementById("ball");
const start = document.getElementById("start");
const rotate = document.getElementById("rotate");
const over = document.getElementById("over");
const timeBox = document.getElementById("time");
const startBtn = document.getElementById("startBtn");

let x = 0;
let vel = 0;
let accel = 0;
let running = false;
let time = 0;

/* ===== SENSOR PERMISSION ===== */
startBtn.onclick = async ()=>{
  if(
    typeof DeviceMotionEvent !== "undefined" &&
    typeof DeviceMotionEvent.requestPermission === "function"
  ){
    const res = await DeviceMotionEvent.requestPermission();
    if(res !== "granted"){
      alert("Motion permission required");
      return;
    }
  }

  start.style.display = "none";
  startMotion();
  reset();
  checkOrientation();
  loop();
};

/* ===== DEVICE MOTION (REAL PHYSICS) ===== */
let motionHandler = null;

function startMotion(){
  if(motionHandler){
    window.removeEventListener("devicemotion", motionHandler);
  }

  motionHandler = (e)=>{
    accel = e.accelerationIncludingGravity.x || 0;
  };

  window.addEventListener("devicemotion", motionHandler);
}

/* ===== ORIENTATION ===== */
function checkOrientation(){
  if(window.innerHeight > window.innerWidth){
    rotate.style.display = "flex";
    running = false;
  }else{
    rotate.style.display = "none";
    running = true;
  }
}
window.addEventListener("resize", checkOrientation);

/* ===== RESET ===== */
function reset(){
  x = (main.offsetWidth - ball.offsetWidth) / 2;
  vel = 0;
  time = 0;
  timeBox.innerText = "0";
  over.style.display = "none";
}

/* ===== RESTART ===== */
function restart(){
  startMotion();
  reset();
  running = true;
  loop();
}

/* ===== GAME LOOP ===== */
function loop(){
  if(!running) return;

  /* cold-drink style physics */
  vel += accel * 0.4;
  vel *= 0.98; // friction
  x += vel;

  ball.style.left = x + "px";

  /* TIME SCORE */
  time += 0.016;
  timeBox.innerText = time.toFixed(1);

  /* CENTER WALL HIT */
  const center = main.offsetWidth / 2;
  const wallLeft = center - 4;
  const wallRight = center + 4;

  const ballLeft = x;
  const ballRight = x + ball.offsetWidth;

  if(ballRight > wallLeft && ballLeft < wallRight){
    running = false;
    over.style.display = "flex";
    return;
  }

  /* SIDE LIMIT */
  if(x < 0 || x + ball.offsetWidth > main.offsetWidth){
    vel *= -0.5;
  }

  requestAnimationFrame(loop);
}
</script>
</body>
</html>
