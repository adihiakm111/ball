<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Accelerometer Game (OUT version)</title>

<style>
body{
  margin:0;
  height:100vh;
  background:#111;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-family:Arial;
  color:white;
}

#score{
  font-size:28px;
  margin-bottom:8px;
}

#info{
  font-size:15px;
  margin-bottom:10px;
  text-align:center;
}

button{
  font-size:18px;
  padding:8px 20px;
  margin-bottom:12px;
}

#track{
  width:90vw;
  max-width:900px;
  height:100px;
  background:#333;
  border-radius:50px;
  position:relative;
  overflow:hidden;
}

#ball{
  width:70px;
  height:70px;
  border-radius:50%;
  background:#00e5ff;
  position:absolute;
  top:15px;
  left:0;
}

#outScreen{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.8);
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  font-size:40px;
}
</style>
</head>

<body>

<div id="score">Score: 0</div>
<div id="info">START dabao → phone seedha rakho</div>

<button id="startBtn">START</button>

<div id="track">
  <div id="ball"></div>
</div>

<div id="outScreen">
  OUT<br>
  <button onclick="location.reload()">RESTART</button>
</div>

<script>
const scoreBox = document.getElementById("score");
const info = document.getElementById("info");
const ball = document.getElementById("ball");
const track = document.getElementById("track");
const startBtn = document.getElementById("startBtn");
const outScreen = document.getElementById("outScreen");

let x = 0;
let velocity = 0;

// sensor
let raw = 0;
let zero = 0;
let calibrated = false;

// score
let startTime = 0;
let score = 0;

let started = false;
let running = false;

/* ===== START ===== */
startBtn.onclick = async ()=>{
  if(started) return;
  started = true;

  if(
    typeof DeviceMotionEvent !== "undefined" &&
    typeof DeviceMotionEvent.requestPermission === "function"
  ){
    const r = await DeviceMotionEvent.requestPermission();
    if(r !== "granted"){
      info.innerText = "Sensor permission denied";
      return;
    }
  }

  x = (track.offsetWidth - ball.offsetWidth) / 2;
  ball.style.left = x + "px";
  velocity = 0;
  score = 0;
  scoreBox.innerText = "Score: 0";

  info.innerText = "Phone seedha rakho (1 sec)...";

  setTimeout(()=>{
    zero = raw;
    calibrated = true;
    running = true;
    startTime = Date.now();
    info.innerText = "Ab LEFT / RIGHT jhukao";
    loop();
  },1000);
};

/* ===== ACCELEROMETER ===== */
window.addEventListener("devicemotion", e=>{
  if(!e.accelerationIncludingGravity) return;

  const ax = e.accelerationIncludingGravity.x || 0;
  const ay = e.accelerationIncludingGravity.y || 0;

  raw = (window.innerHeight > window.innerWidth) ? ax : ay;
});

/* ===== GAME LOOP ===== */
function loop(){
  if(!running || !calibrated) return;

  const tilt = raw - zero;

  const SENS = 0.35;
  velocity += tilt * SENS;
  velocity *= 0.95;
  x += velocity;

  const minX = 0;
  const maxX = track.offsetWidth - ball.offsetWidth;

  // ❌ NO CLAMP → OUT LOGIC
  if(x < minX || x > maxX){
    running = false;
    outScreen.style.display = "flex";
    return;
  }

  ball.style.left = x + "px";

  // score = seconds
  score = Math.floor((Date.now() - startTime) / 1000);
  scoreBox.innerText = "Score: " + score;

  requestAnimationFrame(loop);
}
</script>

</body>
</html>
